<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WFAI Presale</title>
  <!-- Solana Web3.js -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <!-- Solflare Wallet SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@solflare-wallet/sdk@1.4.2/dist/index.iife.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #00ff88;
      --secondary: #17002e;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: var(--secondary);
      color: white;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    .logo {
      width: 200px;
      margin-bottom: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-top: 40px;
    }

    .card {
      background: linear-gradient(145deg, #1a003a, #0d001f);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .wallet-btn, .buy-btn {
      background: var(--primary);
      color: var(--secondary);
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin: 10px;
    }

    .wallet-btn:hover, .buy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
    }

    input[type="number"] {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid var(--primary);
      color: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 16px;
      width: 100%;
      margin: 15px 0;
    }

    .timer {
      font-size: 1.5em;
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      margin: 20px 0;
    }

    #tokenomicsChart {
      margin-top: 30px;
      max-height: 400px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    .modal-content {
      background: var(--secondary);
      padding: 30px;
      border-radius: 15px;
      position: relative;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 400px;
      text-align: center;
    }

    .close {
      color: var(--primary);
      font-size: 24px;
      position: absolute;
      right: 20px;
      top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="https://gateway.pinata.cloud/ipfs/bafybeih3iwshjpvlxlsbg6mazrv77qu3inzpmixvznyaihqa2ut674nklu" alt="WFAI Logo" class="logo">
      <h1>WFAI Token Presale</h1>
    </header>

    <div class="grid">
      <div class="card">
        <h2>üí∞ Presale</h2>
        <button id="connectBtn" class="wallet-btn">Connect Wallet</button>
        <div id="walletAddress" style="margin: 15px 0;"></div>

        <input type="number" id="solAmount" placeholder="Enter SOL Amount" min="0" step="0.1">
        <div class="conversion" style="margin: 15px 0;">
          <strong>Exchange Rate:</strong> 1 SOL = 10,000,000 WFAI<br>
          <strong>You will receive:</strong> <span id="tokenOutput">0</span> WFAI
        </div>
        <button class="buy-btn" onclick="buyTokens()">Buy WFAI Now</button>

        <div class="timer">
          ‚è≥ Presale ends in: <span id="countdown"></span>
        </div>
      </div>

      <div class="card">
        <h2>üìä Tokenomics</h2>
        <canvas id="tokenomicsChart"></canvas>
      </div>
    </div>

    <!-- Wallet Modal -->
    <div id="walletModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Select Wallet</h2>
        <button id="phantomBtn" class="wallet-btn">Phantom</button>
        <button id="solflareBtn" class="wallet-btn">Solflare</button>
      </div>
    </div>
  </div>

  <script>
    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'), 'confirmed');
    const PRESALE_WALLET = new solanaWeb3.PublicKey("GWkwfF8BbA591V4ZFTLDJJ9eRy5Mhp2Z9zNBNFvf6cgy");
    const TOKENS_PER_SOL = 10000000; // 10M per SOL

    let wallet = null;
    let solflareWallet = null;

    // Wallet Connection Handlers
    document.getElementById("phantomBtn").addEventListener("click", async () => {
      try {
        if (window.solana?.isPhantom) {
          await window.solana.connect();
          wallet = window.solana;
          updateWalletDisplay();
          modal.style.display = "none";
        } else if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
          window.location.href = `https://phantom.app/ul/browse/${encodeURIComponent(window.location.href)}`;
        } else {
          alert("Please install Phantom Wallet");
          window.open("https://phantom.app/download", "_blank");
        }
      } catch (error) {
        console.error("Phantom connection error:", error);
        alert("Failed to connect Phantom Wallet");
      }
    });

    document.getElementById("solflareBtn").addEventListener("click", async () => {
      try {
        solflareWallet = new Solflare();
        await solflareWallet.connect();
        wallet = solflareWallet;
        updateWalletDisplay();
        modal.style.display = "none";
      } catch (error) {
        console.error("Solflare connection error:", error);
        alert("Failed to connect Solflare. Ensure extension is installed");
      }
    });

    function updateWalletDisplay() {
      document.getElementById("walletAddress").innerHTML = `
        Connected: ${wallet.publicKey.toString().slice(0, 6)}...${wallet.publicKey.toString().slice(-4)}
      `;
    }

    // Tokenomics Chart
    const ctx = document.getElementById('tokenomicsChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Presale (50%)', 'Airdrop (10%)', 'Liquidity Pool (33%)', 'Marketing (7%)', 'Development (5%)', 'Team (5%)'],
        datasets: [{
          data: [50, 10, 33, 7, 5, 5],
          backgroundColor: [
            '#00ff88',
            '#7b00ff',
            '#ff007b',
            '#ffd700',
            '#00ffff',
            '#ff6600'
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });

    // Rest of the code (transaction handling, timer, etc.) remains similar to previous
    // with TOKENS_PER_SOL updated to 10,000,000 and UI references updated

    // [Include previous transaction handling and timer code here]
    // [Add proper error handling and loading states as needed]
 // Buy Token Function
  async function buyTokens() {
    if (!wallet?.publicKey) {
      alert("Please connect a wallet first.");
      return;
    }

    const solAmount = parseFloat(document.getElementById("solAmount").value);
    if (isNaN(solAmount) || solAmount <= 0) {
      alert("Please enter a valid SOL amount.");
      return;
    }

    try {
      const transaction = new solanaWeb3.Transaction().add(
        solanaWeb3.SystemProgram.transfer({
          fromPubkey: wallet.publicKey,
          toPubkey: PRESALE_WALLET,
          lamports: solanaWeb3.LAMPORTS_PER_SOL * solAmount,
        })
      );

      transaction.feePayer = wallet.publicKey;
      const { blockhash } = await connection.getRecentBlockhash();
      transaction.recentBlockhash = blockhash;

      let signed;
      if (wallet.signTransaction) {
        signed = await wallet.signTransaction(transaction);
      } else if (wallet.sign) {
        signed = await wallet.sign(transaction);
      }

      const signature = await connection.sendRawTransaction(signed.serialize());
      await connection.confirmTransaction(signature, 'confirmed');

      alert(`Success! TX: ${signature}`);
    } catch (error) {
      console.error("Transaction failed:", error);
      alert("Transaction failed! Check console.");
    }
  }

  // Update token output
  document.getElementById("solAmount").addEventListener("input", () => {
    const solAmount = parseFloat(document.getElementById("solAmount").value);
    const tokens = solAmount > 0 ? solAmount * TOKENS_PER_SOL : 0;
    document.getElementById("tokenOutput").innerText = tokens.toLocaleString();
  });

  // Presale Countdown
  const endTime = new Date("2025-06-01T00:00:00Z").getTime(); // adjust as needed

  function updateCountdown() {
    const now = new Date().getTime();
    const distance = endTime - now;

    if (distance < 0) {
      document.getElementById("countdown").innerText = "Presale Ended";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById("countdown").innerText =
      `${days}d ${hours}h ${minutes}m ${seconds}s`;
  }

  setInterval(updateCountdown, 1000);
  updateCountdown();
  </script>
</body>
</html>
